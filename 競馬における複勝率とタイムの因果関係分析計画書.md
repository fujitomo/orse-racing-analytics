# 競馬におけるレースレベルが走破タイムに与える影響の分析
藤野智宏

---

## 1. 論文の概要 (Abstract)

本データ分析は、競馬の走破タイムに影響を及ぼすレースの実質的な「グレード」を定量化するため**特徴量エンジニアリングによって独自の変数「レースレベル」を設計**し、その因果的効果を検証する。
このデータ分析は、レースの公式が取得した2010年から2024年の芝レースデータ（有効サンプル717,636件）を対象に重回帰分析を実行し、「レースレベル」変数が走破タイム（距離調整後）に与える影響を定量的に評価する。

本データ分析は、「独自の変数であるレースレベルが高いとより速いタイムが記録される」という仮説を検証します。
特徴量エンジニアリングの妥当性を示すと共に競走馬の能力評価格付け(G1,G2等)や賞金額さらに「グレードの高いレースは特定距離に集中する」というドメイン知識を反映した**レース環境そのものを表す合成変数**であり、レース結果（着順等）の情報は含まない。

JRA-VANにおける客観的な基準を提供することを目的とする。

---

## 2. データ分析の背景と目的 (Introduction)

### 2.1 テーマ選定の理由

競馬予測において、競走馬の能力を評価する上で「走破タイム」は最も基本的かつ重要な変数の一つである。
しかし、走破タイムはレースが行われる馬の能力・トラックバイアス、そしてレースの「グレード・距離・場所」によって大きく変動するため、異なるレースで記録されたタイムを単純に比較して馬の能力を判断することはできない。

ここで重要となるのが「レースのグレード」の捉え方である。
一般的にG1/G2といった公式のグレードが用いられるが、**これだけではレースの実質的な競争レベルを正確に表現できない**場合がある。
例えば、同じG3レースであっても競馬界において非常にハイレベルな競争が展開される傾向にある中距離（2000m前後）のレースと他の条件のレースとでは出走メンバーの質やレースの重要性が異なり単純に同等とは見なせない。

そこで本データ分析では、これらの複合的な要因を捉えレース環境の「グレード」をより客観的に評価するため、**独自の変数「レースレベル」を特徴量エンジニアリングによって設計**し、回帰分析の主要説明変数として設定した。
この変数は、公式グレードや賞金といった**レース自体の特性のみ**から算出され、そのレースの着順のような結果情報は一切含まない合成変数である。

そこで本分析では、この自作変数「レースレベル」が走破タイムに与える影響を分析することで、**自作変数「レースレベル」が本当にレースのグレードを測るモノサシとして信頼できるのかを確かめます。**
具体的な活用は以下の通りです。

### 本分析で検証される仮説の意義
この検証により「レースレベル」変数の妥当性が確認された場合、以下の重要な問題解決が期待される：

#### **1. 異なるレース間での公平な能力比較手法の確立**

**現在の問題点**：
競馬において、異なるグレードのレースで記録されたタイムを直接比較することは統計的に不適切である。
例えば、G3レースで1分58秒を記録した馬とオープン特別で1分57秒を記録した馬のどちらが優秀かは単純なタイム比較では判断できない。

**本データ分析による解決アプローチ**：
\[
\text{能力調整タイム} = \text{実測タイム} - (\beta \times \text{RaceLevel} + \text{その他補正項})
\]

上記の回帰式により、各馬のタイムからレースレベルの影響を統計的に除去し、「同一条件下での能力」を推定する。

**具体的適用例**：
- **格上挑戦の成功確率予測**: 1600万下で好タイムを記録した馬が重賞で通用するかを、レースレベル差（例：1600万下=3.2, G3=6.8）を用いて定量評価
- **距離適性の客観評価**: 1400mでの実績から2000mでの予想タイムを算出し、距離延長の影響を分離

#### **2. 特徴量エンジニアリング手法としての統計的検証**

**本データ分析結果の価値**：
本データ分析は、ドメイン専門知識を統計モデルに組み込む「特徴量エンジニアリング」の有効性を実証する。
これは以下の一般的な分析課題に適用可能な方法論である：

**手法の詳細**：
1. **ドメイン知識の定量化**: 「中距離重賞の価値が高い」という経験則を数値化（距離ボーナス係数）
2. **合成変数の統計的妥当性**: 重回帰分析により、合成変数が目的変数に有意な影響を与えることを検証
3. **再現可能性の確保**: 算出ロジックを明文化し、他のデータ分析者が同様の結果を得られることを保証

**他分野への応用可能性**：
- **金融分野**: 複数の経済変数から「市場リスクレベル」を合成し、株価予測に活用
- **マーケティング**: 顧客属性から「購買意欲レベル」を算出し、施策効果を測定
- **スポーツ分析**: チーム戦力変数から「リーグレベル」を作成し、選手評価に応用

#### **3. 統計的因果推論における実践的課題の解決**

**因果推論の技術的課題**：
観察データから因果関係を推定する際、**未観測交絡因子**の存在が最大の課題となる。本研究では、レース環境という観測可能な要因を適切にモデル化することで、この問題に対処する。

**具体的な統計手法**：
- **多重共線性の診断**: VIF値による説明変数間の独立性確認
- **残差分析**: モデルの仮定（正規性、等分散性）の検証
- **頑健性検証**: 異なる期間やサンプルでの結果の一貫性確認

この研究は、複雑な実世界データにおける因果推論の実践例として、統計手法の適切な適用方法を示すものである。

### 2.2 仮説の設定

本分析では、「レースレベルが競走タイムに与える影響」を検証対象とする。

- **対立仮説（H₁）**：他の要因（馬の能力、トラックバイアスなど）を影響を取り除いた後でもレースレベルが高いほど走破タイムは有意に**短くなる**（＝負の相関）。
- **帰無仮説（H₀）**：レースレベルと走破タイムの間に有意な関係は存在しない（＝説明変数として有効でない）。

この設定により、`RaceLevel` がタイムに与える**独立した寄与**を統計的に検証する。

---

## 3. データ分析の方法と手順

1. **仮説の設定** : ドメイン知識に基づき、レースレベルが走破タイムに与える影響について仮説を立てる。
2. **データの抽出・加工** : 分析に必要なデータを抽出し、目的に合わせて変数を加工する（例：走破タイムの距離調整）。
3. **データの分布確認** : 各変数の分布を箱ひげ図やヒストグラムで可視化し、外れ値や分布の偏りを確認する。
4. **相関分析** : 主要な変数間の相関係数を算出し、変数間の関連性の強さを概観する。
5. **重回帰分析** : 目的変数を「距離調整後タイム」、説明変数を「レースレベル」他とし、重回帰モデルを構築して偏回帰係数を推定する。
6. **分析結果の評価** : モデルの決定係数 (R²) や各係数の p 値、VIF 値を確認し、モデルの妥当性と結果の統計的有意性を評価する。多重共線性などの問題が発見された場合は、変数選択を行いモデルを修正する。
7. **考察** : 分析結果に基づき、立てた仮説が支持されたかを判断し、結果の意義や限界について考察する。
8. **結論** : データ分析全体の知見を要約し、今後の課題を提示する。

### 3.1 使用データと変数の定義

| 項目 | 内容 | 出典 |
|:---|:---|:---|
| 対象期間 | 2010-01-01 〜 2024-12-31 | JRA-VAN |
| 対象レース | JRA の平地・芝コースの全レース | JRA-VAN |
| サンプル数 | 58,412 レース / 717,636 走行馬 | JRA-VAN |
| 目的変数 | **AdjustedTime** (距離調整後タイム) | 距離カテゴリ内でのZ-score標準化（詳細は3.1.2項） |
| 主要説明変数 | **RaceLevel** (レースレベル) | 特徴量エンジニアリングにより算出（詳細は 3.1.1 項）。 |
| 共変量 | **DistanceCategory**, **TrackCond**, **Year** | JRA-VAN データより抽出・加工 |

### 3.1.1 特徴量エンジニアリング：`RaceLevel` の算出ロジック
本研究の根幹をなす説明変数 `RaceLevel` は、レースの**結果に依存しない、客観的な環境要因**として設計された合成変数である。その算出ロジックは、`analyze_race_level.py` が呼び出す `RaceLevelAnalyzer` クラス内で、各レースに対して以下のステップで実行される。

1.  **基礎レベルの算出**:
    *   **グレードレベル**: G1、G2 といったレースの公式格付けをベースの数値に変換する（例：G1=9, G2=8, ...）。
    *   **賞金レベル**: 1着賞金額を対数変換し、正規化することで賞金規模をレベルに反映。
    *   **基礎レベルの合成**: 上記2つのレベルを `グレード: 0.6`, `賞金: 0.4` の比率で重み付けし、基礎的なレースレベルを算出する。

2.  **距離因子による補正**:
    *   **距離カテゴリによる重み付け**: スプリント（〜1400m）、マイル（〜1800m）、中距離（〜2400m）、長距離（2401m〜）といったカテゴリに応じて重みを乗算する。これにより、一般的にレベルが高いとされる中〜長距離路線の価値を高く評価する。
    *   **重要距離（2000m前後）への特別ボーナス**: クラシック路線や王道路線の中心となる **1900m〜2100m** のレースに対して、さらに **1.35倍** のボーナス係数を乗算する。
    *   **グレードと距離の交互作用**: G1〜G3 のハイレベルなレースが、そのレースの価値が最も高まる中長距離（1800m〜2400m）で施行される場合に、さらにボーナスを与える。

3.  **最終正規化**:
    *   上記の手順で算出された値を、0から10の範囲に収まるようにスケーリングし、最終的な `RaceLevel` 変数とする。

この一連のプロセスにより、単なる公式格付けだけでは表現できない、レース環境が持つ実質的な「格」や「競争レベル」を多角的に捉えた指標を作成している。

### 3.1.2 目的変数：`AdjustedTime` の算出ロジック
データ分析の目的変数である `AdjustedTime` は、距離によるペース戦略の違いを統計的に適切に処理するため、**距離カテゴリ別標準化**を採用している。

**距離カテゴリの定義**：
- **スプリント**: 〜1400m （ハイペース・瞬発力重視）
- **マイル**: 1401-1800m （中間ペース・バランス型）
- **中距離**: 1801-2400m （戦略的ペース配分）
- **長距離**: 2401m〜 （超省エネ→ラストスパート）

**標準化の計算式**：
\[
\text{AdjustedTime}_{i} = \frac{\text{RawTime}_{i} - \mu_{\text{category}}}{\sigma_{\text{category}}}
\]

ここで、$\mu_{\text{category}}$ と $\sigma_{\text{category}}$ は各距離カテゴリ内での走破タイムの平均と標準偏差である。

**統計的妥当性**：
この手法により、異なるペース戦略を持つ距離間での直接比較が可能となり、各馬の「同条件下での相対的能力」を定量化できる。従来の線形距離補正では捉えきれない、距離特有の競走特性を統計モデルに適切に反映している。

**具体例**：
- スプリント1200mで1分8秒（カテゴリ内平均1分9秒）→ AdjustedTime = -1.2
- 中距離2000mで2分1秒（カテゴリ内平均2分2秒）→ AdjustedTime = -1.1

両馬ともカテゴリ内で優秀だが、単純な「1000mあたり換算」では不適切な比較となってしまう問題を、この標準化により解決している。

### 補足：距離適性と距離変更の統計的処理

#### 1. 競走馬の距離適性
競走馬は、その血統や筋繊維の特性から、スプリンター（短距離）、マイラー（中距離）、ステイヤー（長距離）といった**距離適性**を持つ。多くの場合、馬は自身の適性距離範囲内のレースに専門的に出走する。

#### 2. 距離変更が行われる戦略的理由
しかし、キャリア戦略の一環として、以下の理由で意図的に距離を変更する場合がある。
- **適性探索**: 若手時代に最適な距離を見極めるため。
- **競合回避**: 強力なライバルとの直接対決を避けるため。
- **能力変化への適応**: 加齢によるスピード低下をスタミナで補うため。

#### 3. 本分析における統計的アプローチ：距離カテゴリ別標準化
本分析では、このような状況に対応するため、走破タイムを距離カテゴリごとにZ-score標準化する。
\[
\text{AdjustedTime} = \frac{\text{RawTime} - \mu_{\text{category}}}{\sigma_{\text{category}}}
\]
この手法により、各馬のパフォーマンスを、出走したレースの距離カテゴリ内での**相対的な位置（平均からの偏差）**として評価する。

#### 4. 本アプローチの利点
- **公平な比較**: 異なる距離のレース結果を直接比較するのではなく、各カテゴリ内での能力を評価するため、統計的な公平性が保たれる。
- **未知の状況への対応**: ある馬が初めて長距離戦に出走するような場合でも、そのパフォーマンスを「長距離カテゴリの平均」を基準に客観的に測定できる。
- **結果の安定性**: 距離変更のような特殊なケースにも対応できるため、分析結果が外的要因に左右されにくく、安定する。

---

**【具体例】**
あるマイラー（中距離馬）が初めて2400mの長距離戦に出走したとする。
- **従来手法の問題**: 単純なタイム比較では、過去の中距離実績と比較できず、評価が困難。
- **本手法の解決策**: 2400mの走破タイムを「長距離カテゴリ」の平均・標準偏差で標準化することで、その馬のパフォーマンスを**「長距離走者としてどの程度の水準か」**という客観的な尺度で評価できる。

### 3.2 分析手法

重回帰モデル (OLS) を以下の形で構築した。

\[
\text{AdjustedTime} = \beta_0 + \beta_1 \, \text{RaceLevel} + \beta_2 \, \text{DistanceCategory} + \beta_3 \, \text{TrackCond} + \beta_4 \, \text{Year} + \varepsilon
\]

ここで、`DistanceCategory` は距離カテゴリ（スプリント、マイル、中距離、長距離）のダミー変数である。

モデルの信頼性を担保するため、VIF (Variance Inflation Factor) を算出し多重共線性を確認した。

---

## 4. データ分析の結果 (Results)

### 4.1 記述統計と相関

（分析実行後、ここに各変数の記述統計量や、主要変数間の相関行列などを記載予定）

### 4.2 重回帰分析

（分析実行後、ここにモデル全体のF値、決定係数R²、および各変数の分析結果を記載予定。以下は結果のフォーマット例）

| 変数 | 係数 (β) | 標準誤差 | t 値 | p 値 | VIF |
|:---|---:|---:|---:|:---|---:|
| (切片) | [算出予定] | [算出予定] | [算出予定] | [算出予定] | – |
| **RaceLevel** | **[算出予定]** | [算出予定] | [算出予定] | [算出予定] | [算出予定] |
| Distance | [算出予定] | [算出予定] | [算出予定] | [算出予定] | [算出予定] |
| TrackCond[稍重] | [算出予定] | [算出予定] | [算出予定] | [算出予定] | [算出予定] |
| TrackCond[重] | [算出予定] | [算出予定] | [算出予定] | [算出予定] | [算出予定] |
| TrackCond[不良] | [算出予定] | [算出予定] | [算出予定] | [算出予定] | [算出予定] |
| … (Year) | … | … | … | … | … |

---

## 5. 結果の解釈と考察 (Discussion)

### 5.1 仮説の評価

分析結果に基づき、仮説の評価を行う。
もし、RaceLevelの係数が統計的に有意な負の値を示した場合、帰無仮説は棄却され、対立仮説H₁が支持される。その場合、係数の値から「RaceLevelが1単位上昇すると、走破タイムが何秒短縮されるか」を定量的に解釈する。

### 5.2 意義と限界

（分析結果を踏まえ、本研究の意義と限界を具体的に記述予定）

- **意義** : （例：経験則として語られてきたレース格とタイムの関係を、客観的指標と統計モデルで定量的に示した。）
- **限界** :
  1. 因果の方向性（レースレベルがタイムの原因である、という解釈の妥当性）
  2. 騎手能力やレース展開といった、モデルに含まれていない未観測交絡が結果に与える影響
  3. RaceLevelを等間隔の量的変数として扱ったことの妥当性

---

## 6. 結論 (Conclusion)

### 6.1 本研究の目的と期待される成果
本研究では、重回帰分析を用いて独自設計の「レースレベル」変数が走破タイムに与える影響を検証する。この分析により以下の成果が期待される：

1. **特徴量エンジニアリング手法の検証**: 複数の観測変数から合成変数を作成する方法論の統計的妥当性の確認
2. **レース評価手法の客観化**: 公式格付けに加えて賞金・距離要因を統合した評価メトリクスの有効性検証
3. **予測モデル改善の基礎**: レース環境を考慮した能力比較手法の統計的根拠の提供

### 6.2 今後の発展可能性
本分析の結果が仮説を支持した場合、以下の発展が考えられる：

- **手法の一般化**: 他のスポーツ競技における類似の合成変数開発への応用
- **モデルの高度化**: 機械学習手法（ランダムフォレスト、勾配ブースティング等）での非線形関係の探索
- **予測精度の定量評価**: 従来手法との比較による改善効果の測定

### 6.3 研究の限界と課題
1. **因果関係の解釈**: 相関関係の確認に留まり、厳密な因果推論には追加の検証が必要
2. **未観測要因**: 騎手能力やレース展開等、モデルに含まれない要因の影響
3. **変数の一般化**: 他の競馬圏（海外）や時代への適用可能性の検証

本研究は、ドメイン知識と統計手法を組み合わせた分析アプローチの一例として、データサイエンス手法の実践的適用を示すものである。

